<div class="container position-relative" data-controller="answer">
  <!-- Navigation and Exit Button Row -->
  <div class="row fixed-top bg-white align-items-center py-4 mb-3 shadow-sm p-3 mb-5 rounded">
    <div class="col-1 d-flex justify-content-start ms-3">
      <%= link_to course_path(@lesson.course.title), class: "btn btn-link p-0" do %>
        <i class="fas fa-times fa-1x"></i>
      <% end %>
    </div>

    <% prev_step_number = @step.order - 1 %>
    <% next_step_number = @step.order + 1 %>

    <% if prev_step_number > 0 %>
      <div class="col-1 d-flex justify-content-center">
        <%= button_to user_progress_path(@user_progress, step: prev_step_number), method: :patch, class: "btn btn-link p-0" do %>
          <i class="fas fa-arrow-left fa-1x" style="color: #d3d3d3"></i>
        <% end %>
      </div>
    <% else %>
      <div class="col-1"></div>
    <% end %>

    <% progress = (@step.order.to_f / @lesson.steps.count * 100).round %>
    <% total_steps = @lesson.steps.count %>
    <% current_step = @step.order %>

    <div class="col-8 d-flex align-items-center">
      <% total_steps.times do |i| %>
        <div class="progress-segment <%= 'bg-primary' if i < current_step %> flex-grow-1 mx-1">
          <small class="invisible-text"><%= i + 1 %></small>
        </div>
      <% end %>
    </div>

    <% if next_step_number <= @lesson.steps.count %>
      <div class="col-1 d-flex justify-content-center">
        <%= button_to user_progress_path(@lesson.user_progresses.for(current_user), step: next_step_number), method: :patch, class: "btn btn-link p-0" do %>
          <i class="fas fa-arrow-right fa-1x" style="color: #d3d3d3"></i>
        <% end %>
      </div>
    <% else %>
      <div class="col-1"></div>
    <% end %>
  </div>

  <!-- Lesson Title Content and Button Row -->
  <div class="row mt-5 pt-4 d-flex justify-content-center">
    <div class="container-lesson col-6">
      <div class="text-align-left">
        <% if @step.question? %>
          <h2 class="card-title justify-content-center mt-5"><%= @step.content %></h2>
        <% else %>
          <h2 class="card-title justify-content-center mt-5"><%= @step.title %></h2>
        <% end %>
      </div>

      <div class="mb-4 d-flex justify-content-center">
        <% if @step.tutorial? %>
          <div class="card-step text-justify mt-3">
          <p> <%= @step.content %> </p>
            <!--<div class="text-center mt-4 container-image-step">-->
              <%#= image_tag @step.image_name, class: "card-image-step"%>
<!--            </div>-->
          </div>
        <% end %>
      </div>

      <div class="questions mb-3">
        <% if @step.question? %>
          <div class="card-answers list-group mt-5 d-flex justify-content-center">
            <% @step.answers.each do |answer| %>
              <div class="answer-disabled"  data-answer-target="answer" data-action="click->answer#enableBtn" data-correct="<%= answer.is_correct %>">
                <h4> üíÅ <%= answer.content %></h4>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>

      <!--Buttons are now here-->

      <div class="d-flex justify-content-end">
        <% if next_step_number <= @lesson.steps.count %>

          <% if @step.tutorial? %>
            <%= button_to user_progress_path(@lesson.user_progresses.for(current_user), step: next_step_number),
            data:{controller: "click-sound", action: "click-sound#click", click_sound_url_value: "#{asset_url 'sound.mp3'}"},
            method: :patch,
            class: "btn-custom-lesson" do %>
              Continue
            <% end %>


          <% else %>
            <%#= button_to data:{ action: "click->answer#checkAnswer" }, class: "btn-custom-lesson-disabled" do %>
            <button data-answer-target="buttonCheck" data-action="click->answer#checkAnswer" class="btn-custom-lesson-disabled" disabled>
              Check
            </button>

            <div data-answer-target="buttonContinue" data-action ="clicksound#click" class="d-none">
              <%= button_to user_progress_path(@lesson.user_progresses.for(current_user),
              data:{controller: "click-sound", action: "click-sound#click", click_sound_url_value: "#{asset_url 'sound.mp3'}"},
              step: next_step_number),
              method: :patch,
              class: "btn-custom-lesson" do %>
                Continue
              <% end %>
            </div>
            <%# end %>
          <% end %>

        <% else %>
          <div class="button">
            <%= button_to complete_user_progress_path(@user_progress),
            data:{controller: "click-sound", action: "click-sound#click", click_sound_url_value: "#{asset_url 'sound.mp3'}"},
            method: :patch,
            class: "btn-custom-lesson" do %>
              Finish lesson
            <% end %>
          </div>
        <% end %>
      </div>

    </div>
  </div>

</div>
